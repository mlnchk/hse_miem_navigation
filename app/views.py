from flask import Flask
from .pathfinder import shortest_path
from flask import render_template
from app import app
from .forms import LoginForm, InputForm

graph = {
    'LW': {'101', '125', '201', '225', '301', '325', '401', '425', '501', '601'},
    'LN': {'WC1', '107', '108', '207', '208', '217', '307', '308', '317', '407', '408', '417', '505', '506', '603', '604'},
    'LS': {'center', 'Lu', '108', '217', '208', '317', '308', '417', '408', '506', '604', '605'},
    'LE': {'111', '112', '213', '214', '312', '313', '412', '413', '508', '509', '604', '605'},
    'Lu': {'center', 'LS', '108', '113', '217', '208', '317', '308', '417', '408', '506', '604', '605'},
    'center': {'Lu', 'LS', 'LWa', 'La'},
    'WC1': {'121', '107', 'LN'},
    '101': {'LW', '102', '125'},
    '102': {'101', '103', '125'},
    '103': {'102', '104', '124'},
    '104': {'103', '105', '123'},
    '105': {'104', '106', '122'},
    '106': {'105', '107', '121'},
    '107': {'LN', 'WC1'},
    '108': {'LN', 'LS', 'Lu', '109'},
    '109': {'108', '110', '113'},
    '110': {'109', '111'},
    '111': {'110', 'LE'},
    '112': {'LE', '113'},
    '113': {'112', 'Lu'},
    '121': {'WC1', '122', '106'},
    '122': {'121', '123', '105'},
    '123': {'122', '124', '104'},
    '124': {'123', '125', '103'},
    '125': {'LW', '124', '102'},
    'WC2': {'217', '221', '206', '207'},
    '201': {'LW', '202', '225'},
    '202': {'201', '203', '225'},
    '203': {'202', '204', '224'},
    '204': {'203', '205', '223'},
    '205': {'204', '206', '221'},
    '206': {'205', '207', 'WC2'},
    '207': {'206', 'LN', 'WC2'},
    '208': {'LN', '209', 'LS', 'Lu'},
    '209': {'208', '210', '215'},
    '210': {'209', '211', '214'},
    '211': {'210', '212', '214'},
    '212': {'211', '213'},
    '213': {'212', 'LE'},
    # '214': {'215', 'LE'},
    '215': {'Lu', '209'},
    '214': {'213', '215', '210', '211'},
    '217': {'LS', 'LN', 'WC2'},
    '221': {'WC2', '205', '223'},
    '223': {'221', '205', '224'},
    '224': {'223', '225', '203'},
    '225': {'224', '302', 'LW'},
    'WC3': {'317', '321', '306', '307'},
    '301': {'LW', '302', '325'},
    '302': {'301', '303', '325'},
    '303': {'302', '304', '324'},
    '304': {'303', '305', '323'},
    '305': {'304', '306', '321'},
    '306': {'305', '307', 'WC3'},
    '307': {'306', 'LN', 'WC3'},
    '308': {'LN', '309', 'LS', 'Lu'},
    '309': {'308', '310', '315'},
    '310': {'309', '311', '314'},
    '311': {'310', '312', '314'},
    '312': {'311', 'LE'},
    '313': {'314', 'LE'},
    '315': {'Lu', '309'},
    '314': {'313', '315', '310', '311'},
    '317': {'LS', 'LN', 'WC3'},
    '321': {'WC3', '305', '323'},
    '323': {'321', '305', '324'},
    '324': {'323', '325', '303'},
    '325': {'324', '302', 'LW'},
    'WC4': {'417', '421', '406', '407'},
    '401': {'LW', '402', '425'},
    '402': {'401', '403', '425'},
    '403': {'402', '404', '424'},
    '404': {'403', '405', '423'},
    '405': {'404', '406', '421'},
    '406': {'405', '407', 'WC4'},
    '407': {'406', 'LN', 'WC4'},
    '408': {'LN', '409', 'LS', 'Lu'},
    '409': {'408', '410'},
    '410': {'409', '411', '414'},
    '411': {'410', '412', '414'},
    '412': {'411', 'LE'},
    '413': {'414', 'LE'},
    '414': {'413', '410', '411'},
    '417': {'LS', 'LN', 'WC4'},
    '421': {'WC4', '405', '423'},
    '423': {'421', '405', '424'},
    '424': {'423', '425', '403'},
    '425': {'424', '402', 'LW'},
    'WC5': {'505'},
    '501': {'LW', '502'},
    '502': {'503'},
    '503': {'504'},
    '504': {'505'},
    '505': {'WC5', 'LN'},
    '506': {'Lu', 'LN', '507'},
    '507': {'508'},
    '508': {'LE'},
    '509': {'LE'},
    'WC6': {'603'},
    '601': {'LW', '602'},
    '602': {'603'},
    '603': {'LN', 'WC6'},
    '604': {'LN', 'LE', '605'},
    '605': {'LS', 'LE', 'Lu'},
    'WCa': {'La', '227', '233', '327', '333', '427', '433', '516', '511', '611', '607'},
    'LWa': {'center', '226', '233', '326', '333', '426', '433', '510', '516', '606', '611'},
    'La': {'center', 'WCa', '227', '228', '327', '328', '427', '428', '511', '512', '607', '608'},
    '226': {'LWa', '227', '233'},
    '227': {'La', '226'},
    '228': {'La', '229'},
    '229': {'228', '230'},
    '230': {'229', '231', '232'},
    '231': {'230'},
    '232': {'230'},
    '233': {'LWa', '226'},
    '326': {'LWa', '327', '333'},
    '327': {'La', '326'},
    '328': {'La', '329'},
    '329': {'328', '330'},
    '330': {'329', '331', '332'},
    '331': {'330'},
    '332': {'330'},
    '333': {'LWa', '326'},
    '426': {'LWa', '427', '433'},
    '427': {'La', '426'},
    '428': {'La', '429'},
    '429': {'428', '430'},
    '430': {'429', '431', '432'},
    '431': {'430'},
    '432': {'430'},
    '433': {'LWa', '426'},
    '510': {'LWa', '516'},
    '511': {'510', 'La'},
    '512': {'La', '513'},
    '513': {'512', '514'},
    '514': {'513', '515'},
    '515': {'514'},
    '516': {'WCa', '510'},
    '606': {'LWa', '607', '611'},
    '607': {'LWa', '606'},
    '608': {'LWa', '609'},
    '609': {'608', '610'},
    '610': {'609'},
    '611': {'WCa', '606'}
}


@app.route('/', methods=['GET', 'POST'])
@app.route('/index', methods=['GET', 'POST'])
def index():
    form = InputForm()
    # res = path_finder('lest-west', '314')
    # flash('Login requested for OpenID="%s"' % form.openid.data)
    start = form.start.data
    finish = form.finish.data
    # tmp = path_finder(form.openid.data, '314')
    # tmp = path_finder('301', '323')
    tmp = 0
    if start in graph and finish in graph:
        tmp = shortest_path(graph, start, finish)
    else:
        start, finish = 'undefined', 'undefined'
        tmp = 'sorry, but NO'
    return render_template('index.html',
                           title='nav',
                           form=form,
                           start=start,
                           finish=finish,
                           tmp=tmp)
